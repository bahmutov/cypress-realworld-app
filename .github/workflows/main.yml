name: ci
on: [push]

jobs:
  install:
    runs-on: ubuntu-20.04
    steps:
      # https://github.com/actions/checkout
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v2

      # only install dependencies using
      # https://github.com/cypress-io/github-action
      # Since this project uses Yarn, the action restores or creates folders
      #   ~/.cache/yarn
      #   ~/.cache/Cypress
      - name: Install ğŸ“¦
        uses: cypress-io/github-action@v2
        with:
          runTests: false

      - name: Run lint ğŸ§¹
        run: yarn types

      - name: Run unit tests ğŸ§ª
        run: yarn test:unit:ci

      # will create the "build" folder
      - name: Build site ğŸ—
        run: yarn build:ci

      # only pass the local folders we built / updated
      #   ./build
      # TIP: we want to avoid uploading node_modules since it is SLOW
      # https://glebbahmutov.com/blog/parallel-cypress-tests-gh-action/
      - name: Save build folder ğŸ†™
        uses: actions/upload-artifact@v2
        with:
          name: built
          path: |
            build
